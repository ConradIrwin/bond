<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>File: README.rdoc [RDoc Documentation]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <h1 class='name'>README.rdoc</h1>
        <div class='paths'>
          README.rdoc
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>Mon May 03 14:03:01 -0400 2010</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Note: To read a linked version of this README, <a
            href="http://tagaholic.me/bond/doc/">click here</a>
            </p>
            <h2>Description</h2>
            <p>
            <a href="../classes/Bond.html">Bond</a> is on a mission to improve
            irb&#8217;s autocompletion. Aside from doing everything irb&#8217;s can do
            and fixing its quirks, <a href="../classes/Bond.html">Bond</a> can
            autocomplete argument(s) to methods, uniquely completing per module, per
            method and per argument. <a href="../classes/Bond.html">Bond</a> brings
            irb&#8217;s completion closer to bash/zsh as it provides a configuration
            system and a DSL for creating custom completions and completion rules. With
            this configuration system, users can customize their irb autocompletions
            and share it with others. <a href="../classes/Bond.html">Bond</a> is able
            to offer more than irb&#8217;s completion since it uses a Readline C
            extension to get the full line of input when completing as opposed to
            irb&#8217;s last-word approach.
            </p>
            <h2>Install</h2>
            <p>
            Install the gem with:
            </p>
            <pre>sudo gem install bond</pre>
            <h2>Setup</h2>
            <p>
            To start off, replace irb&#8217;s completion (require
            &#8216;irb/completion&#8217;) with Bond&#8217;s enhanced version in your
            irbrc :
            </p>
            <pre>require 'bond'&#x000A;Bond.start</pre>
            <p>
            This gives you more consistent method completion on any object,
            customizable completions and argument completion of some 80+ methods
            including Hash#[], Kernel#system, Kernel#require and some Rails methods.
            </p>
            <h2>Method Argument Completion</h2>
            <p>
            By default, <a href="../classes/Bond.html">Bond</a> autocompletes arguments
            for a number of core methods:
            </p>
            <pre>$ irb&#x000A;# require completes gems and anything in $LOAD_PATH&#x000A;&gt;&gt; require 'rb[TAB]&#x000A;rbconfig.rb          rbconfig/&#x000A;&gt;&gt; require 'rbconfig&#x000A;&gt;&gt; require 'rbconfig.rb'&#x000A;&#x000A;# hash methods can complete their keys&#x000A;&gt;&gt; CONFIG::CONFIG[TAB]&#x000A;&gt;&gt; CONFIG::CONFIG['m[TAB]&#x000A;&gt;&gt; CONFIG::CONFIG['mandir'&#x000A;&gt;&gt; CONFIG::CONFIG['mandir']&#x000A;&#x000A;&gt;&gt; ENV['CO[TAB]&#x000A;COLUMNS       COMMAND_MODE&#x000A;&gt;&gt; ENV['COL[TAB]&#x000A;&gt;&gt; ENV['COLUMNS'&#x000A;&gt;&gt; ENV['COLUMNS']&#x000A;&#x000A;# array methods can complete their elements&#x000A;&gt;&gt; %w{ab bc cd de}.delete '[TAB]&#x000A;ab  bc  cd  de&#x000A;&gt;&gt; %w{ab  bc  cd  de}.delete 'a[TAB]&#x000A;&gt;&gt; %w{ab  bc  cd  de}.delete 'ab'&#x000A;&#x000A;# system can complete shell commands&#x000A;&gt;&gt; system 'ec[TAB]&#x000A;&gt;&gt; system 'echo&#x000A;&gt;&gt; system 'echo'</pre>
            <p>
            <a href="../classes/Bond.html">Bond</a> also comes with some basic Rails
            completions, mostly for attributes/columns of models:
            </p>
            <pre>$ script/console&#x000A;&gt;&gt; Url.column_names&#x000A;=&gt; [&quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;created_at&quot;, &quot;updated_at&quot;]&#x000A;&gt;&gt; Url.create :n[TAB]&#x000A;&gt;&gt; Url.create :name&#x000A;...&#x000A;&gt;&gt; Url.first.update_attribute :d[TAB]&#x000A;&gt;&gt; Url.first.update_attribute :description&#x000A;...</pre>
            <p>
            To see more methods whose arguments can be completed:
            </p>
            <pre>&gt;&gt; puts Bond.list_methods&#x000A;ActiveRecord::Base#[]&#x000A;ActiveRecord::Base#attribute_for_inspect&#x000A;...</pre>
            <h2>Multiple Arguments</h2>
            <p>
            Every time a comma appears after a method, <a
            href="../classes/Bond.html">Bond</a> starts a new completion. This allows a
            method to complete multiple arguments. <b>Each</b> argument can be have a
            unique set of completions since a completion action is aware of what
            argument it is currently completing. Take for example the completion for
            Object#send:
            </p>
            <pre>&gt;&gt; Bond.send :me[TAB]&#x000A;&gt;&gt; Bond.send :method&#x000A;&gt;&gt; Bond.send :method, [TAB]&#x000A;agent       complete    config      recomplete  spy         start&#x000A;&gt;&gt; Bond.send :method, :a[TAB]&#x000A;&gt;&gt; Bond.send :method, :agent&#x000A;=&gt; #&lt;Method: Module#agent&gt;</pre>
            <p>
            Notice the arguments were completed differently: the first completing for
            Bond.send and the second for Bond.method. The second argument was only able
            to complete because there&#8217;s a completion for Module#method. Using
            Object#send it&#8217;s possible to use completions defined for private
            methods i.e. Module#remove_const:
            </p>
            <pre>&gt;&gt; Bond.send :remove_const, :A[TAB]&#x000A;:Agent            :AnywhereMission&#x000A;&gt;&gt; Bond.send :remove_const, :Ag[TAB]&#x000A;&gt;&gt; Bond.send :remove_const, :Agent</pre>
            <p>
            Since <a href="../classes/Bond.html">Bond</a> uses a comma to delimit
            completions, methods whose last argument is a hash can have their hash keys
            autocompleted. Revisiting the above Rails example:
            </p>
            <pre>&gt;&gt; Url.create :n[TAB]&#x000A;&gt;&gt; Url.create :name&#x000A;&gt;&gt; Url.create :name=&gt;'example.com', :d[TAB]&#x000A;&gt;&gt; Url.create :name=&gt;'example.com', :description&#x000A;...&#x000A;&gt;&gt; Url.first.update_attributes :d[TAB]&#x000A;&gt;&gt; Url.first.update_attributes :description&#x000A;&gt;&gt; Url.first.update_attributes :description=&gt;'zzz', :u[TAB]&#x000A;&gt;&gt; Url.first.update_attributes :description=&gt;'zzz', :updated_at&#x000A;...</pre>
            <h2>Creating Completions</h2>
            <p>
            Bond&#8217;s completion resembles bash/zsh&#8217;s. When <a
            href="../classes/Bond.html#M000006">Bond.start</a> is called, <a
            href="../classes/Bond.html">Bond</a> looks up completion files in multiple
            places: ~/.bondrc and ~/.bond/completions/*.rb. Here&#8217;s how bash and
            bond completion definitions compare in their config files:
            </p>
            <pre># Bash&#x000A;complete -W &quot;one two three&quot; example&#x000A;complete -F _example example&#x000A;&#x000A;# Bond&#x000A;complete(:method=&gt;'example') { %w{one two three} }&#x000A;complete(:method=&gt;'example', :action=&gt;'_example')</pre>
            <p>
            To read up on the wealth of completion types one can make, see the docs for
            <a href="../classes/Bond.html#M000002">Bond.complete</a>.
            </p>
            <h3>Creating Argument Completions for Methods</h3>
            <p>
            While the above method completion was a static list, most completions will
            dynamically generate completions based on the method&#8217;s receiver
            (object). Let&#8217;s look at such an example with Hash#[] :
            </p>
            <pre>complete(:method=&gt;&quot;Hash#[]&quot;) {|e| e.object.keys }</pre>
            <p>
            As you can see, the currently typed object is available as the :object
            attribute of the block&#8217;s argument, a <a
            href="../classes/Bond/Input.html">Bond::Input</a> object. This object can
            offer other useful attributes describing what the user has typed. For
            example, the :argument attribute holds the current argument number being
            completed. Here&#8217;s a completion that uses this attribute to complete
            differently for the first argument and remaining arguments:
            </p>
            <pre>complete(:method=&gt;'example') {|e| e.argument &gt; 1 ? %w{verbose force noop} : %w{one two three} }</pre>
            <h3>Creating Other Completions</h3>
            <p>
            First you should know <a href="../classes/Bond.html">Bond</a> works: A user
            creates completion missions with <a
            href="../classes/Bond.html#M000006">Bond.start</a> and its config files
            (which are just <a href="../classes/Bond.html#M000002">Bond.complete</a>
            calls). When a user autocompletes, <a
            href="../classes/Bond.html#M000007">Bond.agent</a> looks up missions in the
            <b>order</b> they were defined and completes with the first one that
            matches. The exception to this ordering are :method completions.
            </p>
            <p>
            To create a completion, <a
            href="../classes/Bond.html#M000002">Bond.complete</a> needs a regexp to
            match the user input and an action to generate completions when it matches.
            If the completion isn&#8217;t working, use <a
            href="../classes/Bond.html#M000004">Bond.spy</a> to see which completion is
            executing. If a completion needs to be placed before existing completions,
            use the :place option.
            </p>
            <h2>Irb&#8217;s Incorrect Completions</h2>
            <p>
            There are a number of incorrect completions irb gives for object methods.
            <a href="../classes/Bond.html">Bond</a> fixes all of the ones described
            below.
            </p>
            <p>
            Irb completes anything surrounded with &#8217;{}&#8217; the same:
            </p>
            <pre>&gt;&gt; proc {}.c[TAB]&#x000A;}.call     }.class    }.clear    }.clone    }.collect&#x000A;&gt;&gt; %w{ab bc}.c[TAB]&#x000A;}.call     }.class    }.clear    }.clone    }.collect&#x000A;&gt;&gt; %r{ab bc}.c[TAB]&#x000A;}.call     }.class    }.clear    }.clone    }.collect&#x000A;&gt;&gt; {}.c[TAB]&#x000A;}.call     }.class    }.clear    }.clone    }.collect&#x000A;&gt;&gt; {}.call&#x000A;NoMethodError: undefined method `call' for {}:Hash&#x000A;        from (irb):1</pre>
            <p>
            There are a number of cases where irb gives a default completion because it
            doesn&#8217;t know what else to do.
            </p>
            <pre> # The default completion&#x000A; &gt;&gt; self.[TAB]&#x000A; Display all 496 possibilities? (y or n)&#x000A;&#x000A; # And all of these cases are apparently the same:&#x000A; &gt;&gt; nil.[TAB]&#x000A; Display all 496 possibilities? (y or n)&#x000A; &gt;&gt; false.[TAB]&#x000A; Display all 496 possibilities? (y or n)&#x000A; &gt;&gt; true.[TAB]&#x000A; Display all 496 possibilities? (y or n)&#x000A; # Regular expressions with spaces&#x000A; &gt;&gt; /man oh man/.[TAB]&#x000A; Display all 496 possibilities? (y or n)&#x000A; # Grouped expressions&#x000A;&gt;&gt; (3 + 4).[TAB]&#x000A;Display all 496 possibilities? (y or n)&#x000A;&#x000A;# Nested hashes and arrays&#x000A;&gt;&gt; {:a=&gt;{:a=&gt;1}}.[TAB]&#x000A;Display all 496 possibilities? (y or n)&#x000A;&gt;&gt; [[1,2], [3,4]].[TAB]&#x000A;Display all 496 possibilities? (y or n)&#x000A;&#x000A;# Any object produced from a method call&#x000A;&gt;&gt; 'awesome'.to_sym.[TAB]&#x000A;Display all 496 possibilities? (y or n)&#x000A;&gt;&gt; :dude.to_s.[TAB]&#x000A;Display all 496 possibilities? (y or n)</pre>
            <p>
            Ranges don&#8217;t get much love
            </p>
            <pre>&gt;&gt; (2..4).[TAB]&#x000A;# Nothing happens</pre>
            <h2>Limitations</h2>
            <p>
            If on a Mac and using Editline as a Readline replacement (Readline::VERSION
            =~ /editline/i), <a href="../classes/Bond.html">Bond</a> will probably not
            work consistently. I strongly recommend switching to the official Readline.
            If using rvm, <a
            href="http://niwos.com/2010/03/19/rvm-on-osx-snow-leopard-readline-errors/">this
            post</a> has good instructions for reinstalling ruby with the official
            Readline.
            </p>
            <h2>Credits</h2>
            <p>
            Thanks to Csaba Hank for <a
            href="http://www.creo.hu/~csaba/ruby/irb-enhancements/doc/files/README.html">providing
            the C extension</a> which <a href="../classes/Bond.html">Bond</a> uses to
            read Readline&#8217;s full buffer. Thanks also goes out to Takao Kouji for
            <a
            href="http://svn.ruby-lang.org/cgi-bin/viewvc.cgi/trunk/ext/readline/readline.c?view=diff&r1=24018&r2=24019">recently
            commiting</a> this Readline enhancement to ruby.
            </p>
            <h2>Links</h2>
            <ul>
            <li><a
            href="http://tagaholic.me/2009/07/16/bond-from-irb-with-completion-love.html">tagaholic.me/2009/07/16/bond-from-irb-with-completion-love.html</a>
            
            </li>
            <li><a
            href="http://tagaholic.me/2009/07/22/better-irb-completion-with-bond.html">tagaholic.me/2009/07/22/better-irb-completion-with-bond.html</a>
            
            </li>
            <li><a
            href="http://tagaholic.me/2009/07/23/mini-irb-and-mini-script-console.html">tagaholic.me/2009/07/23/mini-irb-and-mini-script-console.html</a>
            
            </li>
            </ul>
            <h2>Todo</h2>
            <ul>
            <li>Load completions that come with a gem easily.
            
            </li>
            <li>Make completion actions more synonymous with argument types.
            
            </li>
            <li>Cache expensive completion actions.
            
            </li>
            <li>Ensure completions work when there is additional, unrelated text to the
            right of a completion.
            
            </li>
            </ul>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
